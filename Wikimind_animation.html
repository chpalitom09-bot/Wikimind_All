<!-- START OF FILE Wikimind_animate.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WikiMind Animate PRO - Generative Art Engine</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #050505;
            --text: #ffffff;
            --panel: rgba(20, 20, 20, 0.7);
            --border: rgba(255, 255, 255, 0.1);
            --accent: #7c3aed; /* Violet intense */
            --accent-glow: rgba(124, 58, 237, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- UI Components --- */
        .glass-panel {
            background: var(--panel);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .btn-accent {
            background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 100%);
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .btn-accent:hover { 
            transform: translateY(-2px);
            box-shadow: 0 0 20px var(--accent-glow);
        }
        .btn-accent::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .btn-accent:hover::after { left: 100%; }

        /* Loader */
        .loader {
            width: 16px; height: 16px;
            border: 2px solid #fff;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Preview Area */
        #preview-container {
            width: 100%; height: 100%;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        iframe { width: 100%; height: 100%; border: none; }

        /* Code Overlay */
        .code-overlay {
            position: absolute; inset: 0; background: rgba(10, 10, 15, 0.95);
            color: #a5b3ce; font-family: 'JetBrains Mono', monospace; padding: 20px;
            overflow: auto; display: none; font-size: 11px; line-height: 1.5;
            z-index: 20;
            white-space: pre-wrap;
        }

        /* Console */
        .console-line { margin-bottom: 4px; border-left: 2px solid transparent; padding-left: 6px; }
        .console-info { border-color: #3b82f6; color: #93c5fd; }
        .console-success { border-color: #22c55e; color: #86efac; }
        .console-error { border-color: #ef4444; color: #fca5a5; }
        .console-system { border-color: #a855f7; color: #d8b4fe; }

        /* Particles BG */
        #bg-canvas { position: fixed; inset: 0; z-index: -1; opacity: 0.3; pointer-events: none; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- HEADER -->
    <header class="h-16 border-b border-white/5 bg-black/50 backdrop-blur-md flex items-center justify-between px-6 z-50">
        <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.href='index.html'">
            <div class="w-8 h-8 bg-gradient-to-br from-violet-600 to-indigo-600 rounded-lg flex items-center justify-center font-bold text-white shadow-lg shadow-violet-900/50">A</div>
            <h1 class="font-bold tracking-tight text-lg">WikiMind <span class="text-transparent bg-clip-text bg-gradient-to-r from-violet-400 to-indigo-400">Animate Pro</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden md:flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/10">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-[10px] font-mono uppercase text-gray-400">Mistral Large Engine</span>
            </div>
        </div>
    </header>

    <!-- MAIN INTERFACE -->
    <main class="flex-grow flex flex-col md:flex-row p-4 gap-4 h-[calc(100vh-64px)] overflow-hidden">

        <!-- EDITOR PANEL (Left) -->
        <div class="w-full md:w-[400px] flex flex-col gap-4 animate-fade-in-left">
            
            <!-- Input Area -->
            <div class="glass-panel p-5 flex flex-col flex-grow relative overflow-hidden group">
                <!-- Decorative glow -->
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-violet-600/20 rounded-full blur-3xl pointer-events-none"></div>

                <h2 class="text-sm font-bold uppercase tracking-widest text-gray-400 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-wand-magic-sparkles text-violet-400"></i> Prompt Cr√©atif
                </h2>

                <div class="relative flex-grow mb-4">
                    <textarea id="prompt-input" 
                        class="w-full h-full bg-black/40 border border-white/10 rounded-xl p-4 text-sm font-medium text-white placeholder-gray-600 focus:outline-none focus:border-violet-500/50 focus:ring-1 focus:ring-violet-500/50 transition resize-none"
                        placeholder="Ex: Un trou noir gravitationnel avec des particules qui orbitent et sont aspir√©es au centre, effet de distorsion, couleurs violet et cyan n√©on..."></textarea>
                </div>

                <!-- Advanced Controls -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div>
                        <label class="text-[9px] font-bold uppercase text-gray-500 ml-1 mb-1 block">Rendu</label>
                        <select id="style-select" class="w-full bg-black/40 border border-white/10 rounded-lg py-2 px-3 text-xs text-gray-300 focus:outline-none">
                            <option value="particles">‚ú® Particules & Physique</option>
                            <option value="math">üìê Art Math√©matique (Fractale)</option>
                            <option value="fluid">üíß Fluide & Organique</option>
                            <option value="cyberpunk">üåÜ Cyberpunk / Glitch</option>
                            <option value="cosmos">üåå Espace & Nebula</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[9px] font-bold uppercase text-gray-500 ml-1 mb-1 block">Complexit√©</label>
                        <select id="complexity-select" class="w-full bg-black/40 border border-white/10 rounded-lg py-2 px-3 text-xs text-gray-300 focus:outline-none">
                            <option value="high">üî• Ultra (Push Limits)</option>
                            <option value="medium">‚ö° Rapide</option>
                        </select>
                    </div>
                </div>

                <button onclick="generateAnimation()" id="generate-btn" class="btn-accent w-full py-4 rounded-xl font-bold text-sm tracking-wide shadow-lg flex items-center justify-center gap-2">
                    <span id="btn-text">G√âN√âRER LE CODE</span>
                    <span id="btn-loader" class="loader hidden"></span>
                </button>
            </div>

            <!-- Console Log -->
            <div class="glass-panel p-4 h-40 overflow-hidden flex flex-col">
                <div class="flex justify-between items-center mb-2 border-b border-white/5 pb-2">
                    <span class="text-[10px] font-mono uppercase text-gray-500">Terminal Syst√®me</span>
                    <button onclick="clearConsole()" class="text-[9px] text-gray-600 hover:text-white transition">CLEAR</button>
                </div>
                <div id="console-log" class="flex-grow overflow-y-auto font-mono text-[10px] space-y-1 pr-2 custom-scrollbar">
                    <div class="console-line console-system">> Wikimind Animate v3.1 Ready.</div>
                    <div class="console-line console-system">> Waiting for input...</div>
                </div>
            </div>
        </div>

        <!-- PREVIEW PANEL (Right) -->
        <div class="flex-grow h-full flex flex-col gap-4 relative">
            
            <!-- Toolbar Overlay -->
            <div class="glass-panel p-2 flex justify-between items-center bg-black/80">
                <div class="flex items-center gap-3 px-2">
                    <div class="w-2 h-2 rounded-full bg-gray-600" id="status-dot"></div>
                    <span class="text-[10px] font-bold uppercase text-gray-400" id="status-text">Idle</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleCode()" class="w-8 h-8 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition" title="Voir le Code">
                        <i class="fa-solid fa-code text-xs"></i>
                    </button>
                    <button onclick="downloadCode()" class="w-8 h-8 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition" title="T√©l√©charger HTML">
                        <i class="fa-solid fa-download text-xs"></i>
                    </button>
                    <button onclick="startRecording()" id="record-btn" disabled class="px-3 h-8 rounded-lg bg-red-500/10 text-red-500 border border-red-500/20 text-xs font-bold uppercase hover:bg-red-500 hover:text-white transition disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-2">
                        <i class="fa-solid fa-circle text-[8px]"></i> REC
                    </button>
                </div>
            </div>

            <!-- Iframe Container -->
            <div id="preview-container" class="flex-grow relative border border-white/10">
                <iframe id="result-frame" sandbox="allow-scripts allow-same-origin allow-modals"></iframe>
                
                <!-- Placeholder -->
                <div id="placeholder-msg" class="absolute inset-0 flex flex-col items-center justify-center text-gray-600 gap-4 pointer-events-none">
                    <div class="w-20 h-20 rounded-3xl bg-white/5 flex items-center justify-center text-3xl shadow-2xl border border-white/5">‚ú®</div>
                    <p class="text-xs uppercase tracking-widest font-bold opacity-50">L'IA attend vos instructions</p>
                </div>

                <!-- Code View -->
                <div id="code-view" class="code-overlay custom-scrollbar"></div>
            </div>
        </div>
    </main>

    <!-- LOGIC -->
    <script>
        // CONFIG
        const MISTRAL_API_KEY = "RmL56FeSccbbNpOC1KIDrYozHSFmY5eD"; 
        const API_URL = "https://api.mistral.ai/v1/chat/completions";

        let currentCode = "";
        let mediaRecorder;
        let recordedChunks = [];
        let isRecording = false;

        // LOGGING UTILS
        function log(msg, type = 'info') {
            const consoleEl = document.getElementById('console-log');
            const div = document.createElement('div');
            div.className = `console-line console-${type}`;
            
            // Timestamp
            const time = new Date().toLocaleTimeString('fr-FR', {hour12:false, hour:'2-digit', minute:'2-digit', second:'2-digit'});
            div.innerHTML = `<span class="opacity-50">[${time}]</span> ${msg}`;
            
            consoleEl.appendChild(div);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console-log').innerHTML = '';
            log('Console cleared.', 'system');
        }

        // GENERATION ENGINE
        async function generateAnimation() {
            const prompt = document.getElementById('prompt-input').value.trim();
            const style = document.getElementById('style-select').value;
            const complexity = document.getElementById('complexity-select').value;
            
            if(!prompt) { 
                log("Erreur : Le prompt est vide.", "error"); 
                document.getElementById('prompt-input').focus();
                return; 
            }

            // UI Feedback
            const btn = document.getElementById('generate-btn');
            const btnText = document.getElementById('btn-text');
            const loader = document.getElementById('btn-loader');
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            btn.disabled = true;
            btn.classList.add('opacity-50');
            btnText.innerText = "CR√âATION EN COURS...";
            loader.classList.remove('hidden');
            statusDot.className = "w-2 h-2 rounded-full bg-violet-500 animate-ping";
            statusText.innerText = "Thinking...";
            statusText.className = "text-[10px] font-bold uppercase text-violet-400 animate-pulse";

            log("Connexion √† Mistral Large...", "system");

            // --- THE SECRET SAUCE : THE SYSTEM PROMPT ---
            // C'est ici qu'on force l'IA √† √™tre excellente.
            const systemPrompt = `You are a Demoscene Expert and Creative Coding Master (JavaScript/Canvas).
            
            YOUR GOAL: Create a visually STUNNING, HIGH-PERFORMANCE animation code based on the user request.
            
            TECHNICAL CONSTRAINTS:
            1. OUTPUT: A single, valid HTML5 file containing CSS and pure JavaScript (no external libraries like Three.js/p5.js to ensure reliability).
            2. CANVAS: Must be full screen (window.innerWidth/Height) and handle 'resize' events perfectly.
            3. PERFORMANCE: Use 'requestAnimationFrame' for the loop. Use ES6 Classes for particles/objects.
            4. BACKGROUND: Default to a dark/black background (fillStyle = 'rgba(0,0,0,...)') unless specified otherwise.
            5. CODE QUALITY: Write clean, minified-logic but readable code. Use Math.sin/cos for organic movements.
            
            VISUAL STANDARDS (The "WOW" Factor):
            - Use globalCompositeOperation = 'lighter' or 'screen' for glowing neon effects.
            - Use HSLA colors (hsl(hue, 100%, 50%)) for rainbows/gradients.
            - Implement physics (velocity, acceleration, friction) if things move.
            - If 'particles' are requested: Make them interactive (mouse repulsion/attraction) if possible.
            - Don't just draw circles. Draw trails, gradients, connecting lines between particles.
            
            RESPONSE FORMAT:
            Return ONLY the HTML code. Start with <!DOCTYPE html>. Do not wrap in markdown blocks. Do not explain the code. Just the raw code.
            `;

            // Prompt Engineering
            let augmentedPrompt = `Create a ${style} animation. Complexity level: ${complexity}. Description: ${prompt}. `;
            if(style === 'cyberpunk') augmentedPrompt += " Use neon colors, glitches, grids, futuristic vibe.";
            if(style === 'cosmos') augmentedPrompt += " Use stars, nebula clouds, gravity, orbital mechanics.";
            if(style === 'fluid') augmentedPrompt += " Use smooth bezier curves, liquid motion, soft gradients.";
            augmentedPrompt += " Make it look professional and 'expensive'.";

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MISTRAL_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "mistral-large-latest", // Le plus puissant mod√®le dispo
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: augmentedPrompt }
                        ],
                        temperature: 0.8, // Un peu plus haut pour la cr√©ativit√©
                        max_tokens: 4000
                    })
                });

                if(!response.ok) throw new Error(`API Error: ${response.status}`);

                const data = await response.json();
                let rawCode = data.choices[0].message.content;

                // Nettoyage impitoyable du markdown si l'IA d√©sob√©it
                rawCode = rawCode.replace(/```html/g, "").replace(/```/g, "").trim();

                if(!rawCode.startsWith("<!DOCTYPE html>")) {
                    // Si l'IA a bavard√© avant
                    const startIndex = rawCode.indexOf("<!DOCTYPE html>");
                    if(startIndex !== -1) rawCode = rawCode.substring(startIndex);
                }

                currentCode = rawCode;
                renderCode(currentCode);
                
                log("Code g√©n√©r√© et inject√©.", "success");
                document.getElementById('record-btn').disabled = false;
                statusDot.className = "w-2 h-2 rounded-full bg-green-500";
                statusText.innerText = "Live";
                statusText.className = "text-[10px] font-bold uppercase text-green-500";

            } catch (error) {
                console.error(error);
                log("Erreur critique: " + error.message, "error");
                statusDot.className = "w-2 h-2 rounded-full bg-red-500";
                statusText.innerText = "Error";
                statusText.className = "text-[10px] font-bold uppercase text-red-500";
            } finally {
                btn.disabled = false;
                btn.classList.remove('opacity-50');
                btnText.innerText = "G√âN√âRER LE CODE";
                loader.classList.add('hidden');
            }
        }

        function renderCode(code) {
            const frame = document.getElementById('result-frame');
            document.getElementById('placeholder-msg').style.display = 'none';
            document.getElementById('code-view').textContent = code;
            
            // Reset iframe to avoid memory leaks
            frame.srcdoc = code;
        }

        function toggleCode() {
            const codeView = document.getElementById('code-view');
            const isVisible = codeView.style.display === 'block';
            codeView.style.display = isVisible ? 'none' : 'block';
            log(isVisible ? "Mode Code masqu√©." : "Mode Code affich√©.", 'info');
        }

        function downloadCode() {
            if(!currentCode) { log("Rien √† t√©l√©charger.", "error"); return; }
            const blob = new Blob([currentCode], {type: "text/html"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "wikimind_creation.html";
            a.click();
            log("Fichier HTML t√©l√©charg√©.", "success");
        }

        // RECORDING (Video Export)
        function startRecording() {
            const iframe = document.getElementById('result-frame');
            
            try {
                // On essaie de chopper le canvas dans l'iframe
                const canvas = iframe.contentDocument.querySelector('canvas');
                if (!canvas) { 
                    log("Impossible de trouver un <canvas> dans l'iframe. L'IA a peut-√™tre √©chou√©.", "error"); 
                    return; 
                }

                const stream = canvas.captureStream(60);
                mediaRecorder = new MediaRecorder(stream, { 
                    mimeType: MediaRecorder.isTypeSupported('video/webm; codecs=vp9') ? 'video/webm; codecs=vp9' : 'video/webm' 
                });
                
                recordedChunks = [];
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `wikimind_render_${Date.now()}.webm`;
                    a.click();
                    
                    log("Export vid√©o termin√© (WEBM).", "success");
                    isRecording = false;
                    updateRecordBtnUI();
                };

                mediaRecorder.start();
                isRecording = true;
                updateRecordBtnUI();
                log("Enregistrement vid√©o d√©marr√©...", "system");

            } catch (e) {
                console.error(e);
                log("Erreur d'enregistrement (S√©curit√© Cross-Origin ?)", "error");
            }
        }

        function stopRecording() {
            if(mediaRecorder && isRecording) {
                mediaRecorder.stop();
            }
        }

        function updateRecordBtnUI() {
            const btn = document.getElementById('record-btn');
            if(isRecording) {
                btn.innerHTML = `<i class="fa-solid fa-square text-[8px] animate-pulse"></i> STOP`;
                btn.classList.add('bg-red-500', 'text-white');
                btn.classList.remove('bg-red-500/10', 'text-red-500');
                btn.onclick = stopRecording;
            } else {
                btn.innerHTML = `<i class="fa-solid fa-circle text-[8px]"></i> REC`;
                btn.classList.remove('bg-red-500', 'text-white');
                btn.classList.add('bg-red-500/10', 'text-red-500');
                btn.onclick = startRecording;
            }
        }

        // BACKGROUND ANIMATION (Minimalist)
        (function() {
            const canvas = document.createElement('canvas');
            canvas.id = "bg-canvas";
            document.body.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            let w, h;

            function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
            window.addEventListener('resize', resize);
            resize();

            const particles = Array.from({length: 30}, () => ({
                x: Math.random() * w, y: Math.random() * h,
                vx: (Math.random() - 0.5) * 0.5, vy: (Math.random() - 0.5) * 0.5,
                size: Math.random() * 2
            }));

            function loop() {
                ctx.clearRect(0, 0, w, h);
                ctx.fillStyle = "rgba(255, 255, 255, 0.1)";
                particles.forEach(p => {
                    p.x += p.vx; p.y += p.vy;
                    if(p.x < 0) p.x = w; if(p.x > w) p.x = 0;
                    if(p.y < 0) p.y = h; if(p.y > h) p.y = 0;
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
                });
                requestAnimationFrame(loop);
            }
            loop();
        })();

    </script>
</body>
</html>
