<!-- START OF FILE Wikimind_animate.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WikiMind Animate - G√©n√©rateur d'Animation IA</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #ffffff;
            --text: #111111;
            --card-bg: rgba(249, 250, 251, 0.85);
            --border: #e5e7eb;
            --accent: #8b5cf6; /* Violet pour Animate */
            --accent-hover: #7c3aed;
        }

        .dark-mode {
            --bg: #0f0f0f;
            --text: #eeeeee;
            --card-bg: rgba(22, 22, 22, 0.85);
            --border: #252525;
            --accent: #a78bfa;
            --accent-hover: #8b5cf6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
            height: 100vh;
            display: flex;
            flex-col: column;
        }

        /* --- INTRO ANIMATION --- */
        #intro-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background-color: var(--bg);
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.6s ease-out, visibility 0.6s;
        }
        
        .logo-pulse {
            width: 80px; height: 80px;
            background: var(--text); color: var(--bg);
            border-radius: 24px; display: flex; align-items: center; justify-content: center;
            font-size: 40px; font-weight: 900;
            animation: pulseLogo 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }
        @keyframes pulseLogo {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        /* --- Background Animation Canvas --- */
        #bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; opacity: 0.6;
        }

        /* --- UI Components --- */
        .glass-panel {
            background: var(--card-bg); backdrop-filter: blur(12px);
            border: 1px solid var(--border); border-radius: 24px;
        }

        .btn-primary {
            background-color: var(--text); color: var(--bg);
            transition: transform 0.2s, opacity 0.2s;
        }
        .btn-primary:active { transform: scale(0.95); }

        .btn-accent {
            background-color: var(--accent); color: white;
            transition: all 0.2s;
        }
        .btn-accent:hover { background-color: var(--accent-hover); box-shadow: 0 0 15px rgba(139, 92, 246, 0.4); }

        /* Loader */
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-left-color: var(--accent);
            border-radius: 50%;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Preview Area */
        #preview-container {
            width: 100%; height: 100%;
            border-radius: 16px;
            overflow: hidden;
            background: #000;
            position: relative;
        }
        iframe { width: 100%; height: 100%; border: none; }

        /* Syntax Highlighter Mockup */
        .code-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            color: #0f0; font-family: monospace; padding: 20px;
            overflow: auto; display: none; font-size: 12px;
            z-index: 20;
        }
    </style>
</head>
<body class="flex flex-col h-screen relative overflow-hidden">

    <!-- SPLASH SCREEN -->
    <div id="intro-overlay">
        <div class="flex flex-col items-center gap-4">
            <div class="logo-pulse">W</div>
            <div class="text-xs font-mono uppercase tracking-widest mt-2">Initialisation Animate</div>
        </div>
    </div>

    <!-- BACKGROUND -->
    <canvas id="bg-canvas"></canvas>

    <!-- NAVBAR -->
    <header class="fixed top-0 w-full z-50 border-b border-gray-200/50 dark:border-gray-800/50 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.href='index.html'">
                <div class="w-10 h-10 bg-violet-600 text-white rounded-xl flex items-center justify-center font-black text-xl">A</div>
                <h1 class="hidden md:block text-xl font-black uppercase tracking-tighter italic">WikiMind <span class="text-violet-500">Animate</span></h1>
            </div>
            
            <div class="flex items-center gap-3">
                <div class="px-3 py-1 bg-violet-100 dark:bg-violet-900/30 text-violet-600 dark:text-violet-300 rounded-full text-[10px] font-bold uppercase tracking-widest">
                    <i class="fa-solid fa-robot mr-1"></i> Mistral Powered
                </div>
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-full border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-zinc-800 transition bg-white dark:bg-black">
                    <i class="fa-solid fa-moon text-gray-800 dark:text-white"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow pt-24 pb-6 px-4 md:px-6 w-full max-w-7xl mx-auto h-full z-10 flex flex-col md:flex-row gap-6">

        <!-- LEFT PANEL: CONTROLS -->
        <div class="w-full md:w-1/3 flex flex-col gap-4 animate-up">
            <div class="glass-panel p-6 flex-grow flex flex-col">
                <div class="mb-4">
                    <h2 class="text-2xl font-black tracking-tight mb-1">Studio Cr√©atif</h2>
                    <p class="text-gray-500 text-xs">D√©crivez l'animation, l'IA √©crit le code.</p>
                </div>

                <!-- Prompt Input -->
                <div class="flex-grow relative mb-4">
                    <textarea id="prompt-input" 
                        class="w-full h-full min-h-[150px] bg-gray-50 dark:bg-zinc-900/50 border border-gray-200 dark:border-gray-700 rounded-xl p-4 text-sm focus:ring-2 focus:ring-violet-500 focus:outline-none resize-none"
                        placeholder="Ex: Une pluie de particules n√©on qui r√©agissent comme des feux d'artifice, fond sombre, style cybern√©tique..."></textarea>
                    <div class="absolute bottom-3 right-3 text-gray-400 text-[10px] font-mono">PROMPT</div>
                </div>

                <!-- Settings -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div>
                        <label class="text-[10px] font-bold uppercase text-gray-500 ml-1">Style</label>
                        <select id="style-select" class="w-full mt-1 bg-gray-50 dark:bg-zinc-900 border border-gray-200 dark:border-gray-700 rounded-lg p-2 text-xs font-bold">
                            <option value="canvas">‚ú® Particules / G√©om√©trique</option>
                            <option value="abstract">üé® Art Abstrait</option>
                            <option value="physics">‚öõÔ∏è Simulation Physique</option>
                            <option value="3d">üßä Faux 3D / Perspective</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold uppercase text-gray-500 ml-1">Dur√©e (Boucle)</label>
                        <select id="duration-select" class="w-full mt-1 bg-gray-50 dark:bg-zinc-900 border border-gray-200 dark:border-gray-700 rounded-lg p-2 text-xs font-bold">
                            <option value="infinite">Infinie</option>
                            <option value="5s">5 secondes</option>
                            <option value="10s">10 secondes</option>
                        </select>
                    </div>
                </div>

                <!-- Action Button -->
                <button onclick="generateAnimation()" id="generate-btn" class="w-full btn-accent py-4 rounded-xl font-black uppercase tracking-widest text-sm flex items-center justify-center gap-2 shadow-lg shadow-violet-500/20">
                    <span id="btn-text">G√©n√©rer l'Animation</span>
                    <span id="btn-loader" class="loader hidden"></span>
                </button>
            </div>

            <!-- Status Console -->
            <div class="glass-panel p-4 h-32 overflow-y-auto font-mono text-[10px] text-gray-500" id="console-log">
                <div class="text-violet-500">> Syst√®me pr√™t.</div>
                <div>> En attente de prompt...</div>
            </div>
        </div>

        <!-- RIGHT PANEL: PREVIEW -->
        <div class="w-full md:w-2/3 h-[500px] md:h-auto relative animate-up" style="animation-delay: 0.1s;">
            <div class="glass-panel p-2 h-full flex flex-col relative">
                <!-- Toolbar -->
                <div class="absolute top-4 right-4 z-30 flex gap-2">
                    <button onclick="toggleCode()" class="bg-black/50 text-white p-2 rounded-lg backdrop-blur-md hover:bg-black/70 text-xs" title="Voir le Code">
                        <i class="fa-solid fa-code"></i>
                    </button>
                    <button onclick="resetPreview()" class="bg-black/50 text-white p-2 rounded-lg backdrop-blur-md hover:bg-black/70 text-xs" title="Reset">
                        <i class="fa-solid fa-rotate-right"></i>
                    </button>
                </div>

                <!-- Viewport -->
                <div id="preview-container" class="rounded-xl shadow-2xl">
                    <iframe id="result-frame" sandbox="allow-scripts allow-same-origin"></iframe>
                    <div id="placeholder-msg" class="absolute inset-0 flex flex-col items-center justify-center text-gray-500 gap-4">
                        <div class="w-16 h-16 rounded-2xl bg-gray-100 dark:bg-zinc-800 flex items-center justify-center text-2xl animate-pulse">üé¨</div>
                        <p class="text-xs uppercase tracking-widest font-bold">Aucune animation g√©n√©r√©e</p>
                    </div>
                    <!-- Code Overlay -->
                    <div id="code-view" class="code-overlay rounded-xl"></div>
                </div>

                <!-- Bottom Actions -->
                <div class="mt-2 flex justify-between items-center px-2">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse" id="rec-dot" style="display:none;"></div>
                        <span class="text-[10px] font-bold uppercase text-gray-500" id="status-text">Pr√™t</span>
                    </div>
                    <div class="flex gap-2">
                         <button onclick="downloadCode()" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-zinc-800 text-xs font-bold uppercase hover:bg-gray-300 dark:hover:bg-zinc-700 transition">
                            <i class="fa-solid fa-file-code mr-1"></i> HTML
                        </button>
                        <button onclick="startRecording()" id="record-btn" disabled class="px-4 py-2 rounded-lg bg-red-500/10 text-red-500 border border-red-500/20 text-xs font-bold uppercase hover:bg-red-500 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa-solid fa-video mr-1"></i> Enregistrer (MP4)
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- SCRIPTS -->
    <script>
        // --- CONFIGURATION ---
        // ‚ö†Ô∏è API KEY INTEGR√âE (Pour d√©monstration imm√©diate, √† s√©curiser en prod)
        const MISTRAL_API_KEY = "RmL56FeSccbbNpOC1KIDrYozHSFmY5eD"; 
        const API_URL = "https://api.mistral.ai/v1/chat/completions";

        let currentCode = "";
        let mediaRecorder;
        let recordedChunks = [];
        let isRecording = false;

        // --- UI LOGIC ---
        function log(msg, type = 'info') {
            const consoleEl = document.getElementById('console-log');
            const div = document.createElement('div');
            div.innerText = `> ${msg}`;
            if(type === 'error') div.className = "text-red-500 font-bold";
            if(type === 'success') div.className = "text-green-500 font-bold";
            consoleEl.appendChild(div);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        // --- CORE: GENERATION IA ---
        async function generateAnimation() {
            const prompt = document.getElementById('prompt-input').value.trim();
            const style = document.getElementById('style-select').value;
            
            if(!prompt) { alert("Veuillez d√©crire une animation."); return; }

            // UI Update
            const btn = document.getElementById('generate-btn');
            const btnText = document.getElementById('btn-text');
            const loader = document.getElementById('btn-loader');
            
            btn.disabled = true;
            btnText.innerText = "G√©n√©ration...";
            loader.classList.remove('hidden');
            log("Envoi de la requ√™te √† Mistral AI...");

            // System Prompt optimis√© pour le code cr√©atif
            const systemPrompt = `Tu es un expert en Creative Coding et JavaScript.
            Ta t√¢che : G√©n√©rer un fichier HTML complet contenant une animation sur un <canvas>.
            
            R√®gles strictes :
            1. Un seul fichier HTML. CSS et JS inclus (<style>, <script>).
            2. Utilise l'API Canvas HTML5 standard. Pas de biblioth√®ques externes (pas de p5.js, three.js).
            3. Le canvas doit prendre 100% de la largeur/hauteur (window.innerWidth).
            4. L'animation doit √™tre fluide (requestAnimationFrame).
            5. G√®re le redimensionnement de la fen√™tre.
            6. Style demand√© : ${style}.
            7. Adapte les couleurs pour un fond sombre (car l'interface est sombre).
            8. Ne r√©ponds QUE par le code HTML. Pas d'explications avant ou apr√®s. Commence par <!DOCTYPE html>.`;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MISTRAL_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "mistral-large-latest", // Ou codestral-latest si dispo
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: `Cr√©e une animation : ${prompt}` }
                        ],
                        temperature: 0.7
                    })
                });

                if(!response.ok) throw new Error("Erreur API : " + response.status);

                const data = await response.json();
                let rawCode = data.choices[0].message.content;

                // Nettoyage du code (Markdown removal)
                rawCode = rawCode.replace(/```html/g, "").replace(/```/g, "");

                currentCode = rawCode;
                renderCode(currentCode);
                
                log("Code g√©n√©r√© avec succ√®s !", "success");
                document.getElementById('record-btn').disabled = false;

            } catch (error) {
                console.error(error);
                log("Erreur de g√©n√©ration : " + error.message, "error");
                alert("Erreur lors de la g√©n√©ration.");
            } finally {
                btn.disabled = false;
                btnText.innerText = "G√©n√©rer l'Animation";
                loader.classList.add('hidden');
            }
        }

        // --- RENDER LOGIC ---
        function renderCode(code) {
            const frame = document.getElementById('result-frame');
            document.getElementById('placeholder-msg').style.display = 'none';
            document.getElementById('code-view').innerText = code;
            
            // Injection via srcdoc
            frame.srcdoc = code;
        }

        function toggleCode() {
            const codeView = document.getElementById('code-view');
            codeView.style.display = codeView.style.display === 'block' ? 'none' : 'block';
        }

        function resetPreview() {
            document.getElementById('result-frame').srcdoc = "";
            document.getElementById('placeholder-msg').style.display = 'flex';
            document.getElementById('record-btn').disabled = true;
            currentCode = "";
        }

        function downloadCode() {
            if(!currentCode) return;
            const blob = new Blob([currentCode], {type: "text/html"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "wikimind_animation.html";
            a.click();
        }

        // --- RECORDING LOGIC (VIDEO EXPORT) ---
        function startRecording() {
            const iframe = document.getElementById('result-frame');
            
            // Acc√®s au canvas dans l'iframe (n√©cessite allow-same-origin)
            try {
                const canvas = iframe.contentDocument.querySelector('canvas');
                if (!canvas) { alert("Aucun canvas d√©tect√© dans l'animation."); return; }

                const stream = canvas.captureStream(60); // 60 FPS
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp9' });
                
                recordedChunks = [];
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `wikimind_animate_${Date.now()}.webm`; // .webm est le plus s√ªr via browser
                    a.click();
                    
                    document.getElementById('rec-dot').style.display = 'none';
                    document.getElementById('status-text').innerText = "Export termin√©";
                    document.getElementById('record-btn').innerHTML = '<i class="fa-solid fa-video mr-1"></i> Enregistrer (MP4)';
                    document.getElementById('record-btn').classList.remove('bg-red-500', 'text-white');
                    isRecording = false;
                };

                mediaRecorder.start();
                isRecording = true;
                
                // UI changes
                document.getElementById('rec-dot').style.display = 'block';
                document.getElementById('status-text').innerText = "Enregistrement...";
                document.getElementById('record-btn').innerHTML = '<i class="fa-solid fa-square mr-1"></i> Stopper';
                document.getElementById('record-btn').onclick = stopRecording;
                document.getElementById('record-btn').classList.add('bg-red-500', 'text-white');

            } catch (e) {
                console.error(e);
                alert("Impossible de capturer la vid√©o (Cross-Origin Restriction possible si en local sans serveur).");
            }
        }

        function stopRecording() {
            if(mediaRecorder && isRecording) {
                mediaRecorder.stop();
                document.getElementById('record-btn').onclick = startRecording;
            }
        }

        // --- THEME & INIT ---
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('wikimind_theme', isDark ? 'dark' : 'light');
        }

        window.onload = () => {
            // Theme Init
            if (localStorage.getItem('wikimind_theme') === 'dark' || (!localStorage.getItem('wikimind_theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark-mode');
            }
            
            // Remove splash
            setTimeout(() => {
                document.getElementById('intro-overlay').style.opacity = '0';
                document.getElementById('intro-overlay').style.visibility = 'hidden';
            }, 1000);

            // Init BG
            initCanvas();
        };

        // --- BACKGROUND ANIMATION ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function initCanvas() { resize(); createParticles(); animate(); }
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        function createParticles() {
            particles = [];
            for (let i = 0; i < 40; i++) {
                particles.push({ x: Math.random() * width, y: Math.random() * height, vx: (Math.random() - 0.5) * 0.4, vy: (Math.random() - 0.5) * 0.4, size: Math.random() * 2 + 1 });
            }
        }
        function animate() {
            ctx.clearRect(0, 0, width, height);
            const isDark = document.body.classList.contains('dark-mode');
            ctx.fillStyle = isDark ? 'rgba(255,255,255,0.4)' : 'rgba(0,0,0,0.4)';
            for (let p of particles) {
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > width) p.vx *= -1; if (p.y < 0 || p.y > height) p.vy *= -1;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
            }
            requestAnimationFrame(animate);
        }
        window.addEventListener('resize', () => { resize(); createParticles(); });

    </script>
</body>
</html>