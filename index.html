<!DOCTYPE html>
<html lang="fr">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-29XYBNJ2CB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-29XYBNJ2CB');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WikiMind - La Suite Intelligente</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #ffffff;
            --text: #111111;
            --card-bg: rgba(249, 250, 251, 0.8);
            --border: #e5e7eb;
            --accent: #000000;
            --accent-text: #ffffff;
            --star-inactive: #d1d5db;
            --star-active: #fbbf24;
        }

        .dark-mode {
            --bg: #0f0f0f;
            --text: #eeeeee;
            --card-bg: rgba(22, 22, 22, 0.8);
            --border: #252525;
            --accent: #ffffff;
            --accent-text: #000000;
            --star-inactive: #374151;
            --star-active: #fbbf24;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
        }

        /* --- INTRO ANIMATION (Splash Screen) --- */
        #intro-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background-color: var(--bg);
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), visibility 0.8s;
        }
        
        .logo-pulse {
            width: 80px; height: 80px;
            background: var(--text);
            color: var(--bg);
            border-radius: 24px;
            display: flex; align-items: center; justify-content: center;
            font-size: 40px; font-weight: 900;
            animation: pulseLogo 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }

        @keyframes pulseLogo {
            0%, 100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 rgba(0,0,0,0); }
            50% { transform: scale(1.1); opacity: 0.8; box-shadow: 0 0 30px rgba(128,128,128,0.3); }
        }

        .content-reveal {
            animation: revealUp 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes revealUp {
            from { opacity: 0; transform: translateY(40px) scale(0.95); filter: blur(10px); }
            to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
        }

        /* --- Background Animation Canvas --- */
        #bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; opacity: 0.6;
        }
        .dark-mode #bg-canvas { opacity: 0.4; }

        /* --- Animations Globales --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }

        .animate-fade { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }
        .delay-400 { animation-delay: 0.4s; }
        .delay-500 { animation-delay: 0.5s; }
        .animate-float { animation: float 6s ease-in-out infinite; }

        /* --- View Transitions --- */
        .view-container {
            display: none; opacity: 0;
            transition: opacity 0.4s ease, transform 0.4s ease;
            transform: scale(0.98); width: 100%;
        }
        .view-container.active { display: block; opacity: 1; transform: scale(1); }

        /* --- Components --- */
        .app-card {
            background: var(--card-bg); backdrop-filter: blur(12px);
            border: 1px solid var(--border); border-radius: 24px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative; overflow: hidden; width: 100%; cursor: pointer;
        }
        .app-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--text);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); z-index: 10;
        }
        .dark-mode .app-card:hover { box-shadow: 0 20px 40px rgba(255,255,255,0.05); }

        .icon-box {
            width: 60px; height: 60px; border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; margin-bottom: 1.5rem;
            background: var(--bg); border: 1px solid var(--border);
        }

        .btn-primary {
            background-color: var(--accent); color: var(--accent-text);
            transition: transform 0.2s, opacity 0.2s;
        }
        .btn-primary:hover { transform: scale(1.05); opacity: 0.9; }

        /* Rating Stars */
        .star-rating { display: inline-flex; gap: 2px; }
        .star { color: var(--star-inactive); transition: color 0.2s; cursor: pointer; }
        .star.active, .star:hover, .star-rating:hover .star:hover ~ .star { color: var(--star-active); }

        /* Modal */
        .modal {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
            z-index: 100; align-items: center; justify-content: center;
        }
        .modal-content {
            background: var(--bg); border: 1px solid var(--border);
            padding: 2rem; border-radius: 24px; width: 90%; max-width: 500px;
            max-height: 80vh; overflow-y: auto;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen relative overflow-hidden"> <!-- overflow hidden initially for splash -->
    
    <!-- SPLASH SCREEN INTRO -->
    <div id="intro-overlay">
        <div class="flex flex-col items-center gap-4">
            <div class="logo-pulse">W</div>
            <div class="h-1 w-24 bg-gray-200 dark:bg-gray-800 rounded-full overflow-hidden mt-4">
                <div class="h-full bg-black dark:bg-white animate-[loading_1.5s_ease-in-out_infinite]" style="width: 50%"></div>
            </div>
        </div>
        <style>@keyframes loading { 0% { transform: translateX(-100%); } 100% { transform: translateX(200%); } }</style>
    </div>

    <!-- CANEVAS D'ANIMATION -->
    <canvas id="bg-canvas"></canvas>

    <!-- WRAPPER GLOBAL POUR L'EFFET REVEAL -->
    <div id="app-wrapper" class="opacity-0 flex flex-col min-h-screen">

        <!-- NAVBAR -->
        <header class="fixed top-0 w-full z-50 border-b border-gray-200/50 dark:border-gray-800/50 backdrop-blur-md transition-colors duration-500">
            <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                <div class="flex items-center gap-3 cursor-pointer" onclick="switchView('home')">
                    <div class="w-10 h-10 bg-black dark:bg-white text-white dark:text-black rounded-xl flex items-center justify-center font-black text-xl hover:rotate-12 transition-transform duration-300">W</div>
                    <h1 class="text-xl font-black uppercase tracking-tighter italic">WikiMind</h1>
                </div>
                
                <div class="flex items-center gap-4">
                    <button onclick="switchView('catalog')" class="hidden md:block text-xs font-bold uppercase tracking-widest hover:text-gray-500 transition">Catalogue</button>
                    
                    <a href="Wikimind_vote.html" class="hidden md:flex items-center gap-2 px-4 py-2 rounded-full border border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-zinc-800 transition text-xs font-bold uppercase tracking-widest">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg>
                        <span>Voter</span>
                    </a>

                    <a href="user.html" id="auth-btn" class="hidden md:flex items-center gap-2 px-4 py-2 rounded-full bg-gray-100 dark:bg-zinc-800 text-xs font-bold uppercase tracking-widest hover:bg-gray-200 dark:hover:bg-zinc-700 transition">
                        <span>Mon Compte</span>
                    </a>

                    <button onclick="toggleTheme()" class="w-10 h-10 rounded-full border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-zinc-800 transition">
                        <svg id="theme-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- MAIN CONTAINER -->
        <main class="flex-grow pt-32 pb-20 px-6 max-w-7xl mx-auto w-full z-10 flex flex-col justify-center">

            <!-- VIEW: HOME -->
            <div id="view-home" class="view-container active">
                <div class="text-center mb-24 animate-fade">
                    <div class="inline-block mb-4 px-4 py-1.5 rounded-full border border-gray-200 dark:border-gray-800 bg-gray-50/50 dark:bg-zinc-900/50 backdrop-blur-md text-[10px] font-bold uppercase tracking-widest text-gray-500 animate-float">
                        La Suite Intelligente
                    </div>
                    <h2 class="text-5xl md:text-7xl font-black tracking-tighter mb-6 leading-tight">
                        BOOSTEZ VOTRE<br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-black to-gray-500 dark:from-white dark:to-gray-500">POTENTIEL.</span>
                    </h2>
                    <p class="text-lg text-gray-500 max-w-2xl mx-auto font-medium">
                        Une suite d'outils connect√©s pour apprendre, cr√©er et s'organiser. Propuls√© par une architecture IA de pointe.
                    </p>
                    <div class="mt-8 flex flex-col md:flex-row gap-4 justify-center items-center">
                        <a href="user.html" class="btn-primary px-8 py-4 rounded-full font-bold uppercase tracking-widest text-xs inline-flex items-center gap-2">
                            Commencer Gratuitement
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </a>
                        <a href="Wikimind_presentation.html" class="px-8 py-4 rounded-full font-bold uppercase tracking-widest text-xs inline-flex items-center gap-2 border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-zinc-800 transition-all hover:scale-105 backdrop-blur-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            Pr√©senter le projet
                        </a>
                    </div>
                </div>

                <!-- HOME GRID (Apps) -->
                <div id="home-grid" class="flex flex-wrap justify-center gap-6 w-full mb-12"></div>

                <div class="text-center animate-fade delay-600 mb-24">
                    <button onclick="switchView('catalog')" class="inline-flex items-center gap-2 px-6 py-3 rounded-full border border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-zinc-900 transition-all duration-300 text-xs font-bold uppercase tracking-widest backdrop-blur-sm">
                        <span>Voir tout l'√©cosyst√®me</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>

                <!-- ABOUT SECTIONS -->
                <div class="mt-24 border-t border-gray-100 dark:border-gray-800 pt-16 grid grid-cols-1 lg:grid-cols-2 gap-16 animate-fade delay-300">
                    <div>
                        <h3 class="text-3xl font-black uppercase tracking-tight mb-4">Pourquoi WikiMind ?</h3>
                        <p class="text-gray-500 leading-relaxed mb-8">
                            Contrairement aux outils classiques, l'√©cosyst√®me WikiMind est con√ßu pour √™tre modulaire, respectueux de la vie priv√©e (Local Storage) et interconnect√©. Une seule identit√© pour tous vos outils.
                        </p>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 rounded-xl bg-gray-50/50 dark:bg-zinc-900/50 border border-gray-100 dark:border-gray-800">
                                <div class="font-bold mb-1">üîí 100% Local</div>
                                <div class="text-xs text-gray-500">Donn√©es stock√©es sur votre appareil.</div>
                            </div>
                            <div class="p-4 rounded-xl bg-gray-50/50 dark:bg-zinc-900/50 border border-gray-100 dark:border-gray-800">
                                <div class="font-bold mb-1">üöÄ Multi-Mod√®les</div>
                                <div class="text-xs text-gray-500">Llama, Mistral, Gemini r√©unis.</div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-3xl font-black uppercase tracking-tight mb-4">Pourquoi ce nom ?</h3>
                        <div class="text-gray-500 leading-relaxed space-y-4">
                            <p>√Ä l'origine, le projet est n√© d'une id√©e simple : cr√©er une intelligence artificielle capable de sourcer ses r√©ponses directement depuis les donn√©es fiables de <a href="https://www.wikipedia.org/" target="_blank" class="font-bold text-black dark:text-white underline hover:no-underline transition">Wikipedia</a>.</p>
                            <p>C'est de cet h√©ritage que vient le pr√©fixe <strong>"Wiki"</strong>. Le suffixe <strong>"Mind"</strong> (l'esprit) incarne la capacit√© de r√©fl√©chir, d'analyser et de synth√©tiser.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: CATALOG -->
            <div id="view-catalog" class="view-container">
                <div class="flex flex-col items-center mb-12">
                    <button onclick="switchView('home')" class="mb-8 text-xs font-bold uppercase tracking-widest text-gray-400 hover:text-black dark:hover:text-white transition">‚Üê Retour √† l'accueil</button>
                    <h2 class="text-4xl md:text-5xl font-black tracking-tighter mb-4">Catalogue des Applications</h2>
                    <p class="text-gray-500 max-w-xl text-center">Toutes les solutions WikiMind √† port√©e de clic.</p>
                </div>
                <div id="catalog-grid" class="flex flex-wrap justify-center gap-6 w-full"></div>
                <div class="w-full mt-16 mb-4 flex flex-col items-center justify-center animate-fade delay-100">
                    <div class="p-1 rounded-2xl bg-gradient-to-r from-gray-200 to-gray-100 dark:from-zinc-800 dark:to-zinc-900 shadow-sm hover:shadow-md transition-shadow">
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSffzaqJ8p4m7gaojh2EsVVgYzZ3LDVKAaO5BsvZud4NIZqaJg/viewform?usp=publish-editor" target="_blank" class="block bg-var(--card-bg) px-8 py-4 rounded-xl text-center hover:bg-transparent transition-all duration-300 group relative overflow-hidden bg-white dark:bg-black">
                            <span class="relative z-10 text-xs font-black uppercase tracking-widest flex items-center gap-3 text-gray-500 group-hover:text-black dark:group-hover:text-white transition-colors">
                                <span class="text-xl leading-none">+</span> Proposer une Application
                            </span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- VIEW: DETAIL -->
            <div id="view-detail" class="view-container">
                <button onclick="switchView('catalog')" class="mb-8 text-xs font-bold uppercase tracking-widest text-gray-400 hover:text-black dark:hover:text-white transition">‚Üê Retour au catalogue</button>
                <div class="bg-white/80 dark:bg-[#111]/80 backdrop-blur-xl border border-gray-200 dark:border-gray-800 rounded-3xl overflow-hidden shadow-2xl">
                    <div class="p-8 md:p-12 border-b border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-[#161616]/50">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                            <div class="flex items-center gap-6">
                                <div id="detail-icon" class="w-20 h-20 rounded-2xl bg-black dark:bg-white text-white dark:text-black flex items-center justify-center text-4xl shadow-lg">üß†</div>
                                <div>
                                    <div id="detail-tag" class="inline-block mb-2 px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider bg-blue-100 text-blue-600">Flagship</div>
                                    <h1 id="detail-title" class="text-3xl md:text-4xl font-black tracking-tight">WikiMind AI</h1>
                                    <div class="mt-2 flex items-center gap-3">
                                        <div id="detail-stars" class="flex text-lg"></div>
                                        <div class="text-xs text-gray-500 font-bold uppercase tracking-wider" id="detail-rating-text">Chargement...</div>
                                    </div>
                                </div>
                            </div>
                            <a id="detail-btn" href="#" class="btn-primary px-8 py-4 rounded-xl font-bold uppercase tracking-widest text-sm flex items-center gap-3">Ouvrir l'application</a>
                        </div>
                    </div>
                    <div class="p-8 md:p-12 grid grid-cols-1 lg:grid-cols-3 gap-12">
                        <div class="lg:col-span-2">
                            <h3 class="text-xl font-bold uppercase tracking-tight mb-4">Description</h3>
                            <p id="detail-desc" class="text-gray-500 leading-loose mb-8 text-lg"></p>
                            <h3 class="text-xl font-bold uppercase tracking-tight mb-4">Fonctionnalit√©s Principales</h3>
                            <ul id="detail-features" class="space-y-4 text-gray-600 dark:text-gray-400"></ul>
                        </div>
                        <div class="bg-gray-50 dark:bg-zinc-900 rounded-2xl p-6 h-fit border border-gray-100 dark:border-gray-800">
                            <h4 class="font-bold uppercase tracking-widest text-xs mb-6 text-gray-400">Fiche Technique</h4>
                            <div id="detail-extras" class="space-y-6"></div>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- FOOTER -->
        <footer class="border-t border-gray-200 dark:border-gray-800 py-10 z-10 bg-white/50 dark:bg-black/50 backdrop-blur-sm">
            <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-center md:text-left">
                    <div class="font-black uppercase tracking-tight text-sm">WikiMind Project</div>
                    <div class="text-xs text-gray-500 mt-1">¬© 2026 Tous droits r√©serv√©s.</div>
                </div>
                <div class="flex gap-6 text-xs font-bold uppercase tracking-widest text-gray-400">
                    <button onclick="openModal('legal-modal')" class="hover:text-black dark:hover:text-white transition">Mentions L√©gales</button>
                    <button onclick="openModal('privacy-modal')" class="hover:text-black dark:hover:text-white transition">Confidentialit√©</button>
                    <a href="https://github.com/chpalitom09-bot" target="_blank" class="hover:text-black dark:hover:text-white transition">GitHub</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- MODALS -->
    <div id="legal-modal" class="modal" onclick="closeModal('legal-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 class="text-xl font-black uppercase mb-4">Mentions L√©gales</h3>
            <div class="text-sm text-gray-500 space-y-4 leading-relaxed"><p><strong>√âditeur :</strong> Projet Open Source WikiMind.</p></div>
            <button onclick="closeModal('legal-modal')" class="w-full mt-6 btn-primary py-3 rounded-xl font-bold text-xs uppercase tracking-widest">Fermer</button>
        </div>
    </div>
    <div id="privacy-modal" class="modal" onclick="closeModal('privacy-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 class="text-xl font-black uppercase mb-4">Confidentialit√©</h3>
            <div class="text-sm text-gray-500 space-y-4 leading-relaxed"><p><strong>Privacy First :</strong> Aucune donn√©e personnelle n'est envoy√©e.</p></div>
            <button onclick="closeModal('privacy-modal')" class="w-full mt-6 btn-primary py-3 rounded-xl font-bold text-xs uppercase tracking-widest">Fermer</button>
        </div>
    </div>

    <!-- FIREBASE AND APP LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

        // CONFIG WIKIMIND RATE
        const firebaseConfig = {
            apiKey: "AIzaSyCna0s3guy723jPdW0AdMVGLKE1J4OGmY0",
            authDomain: "wikimind-rate.firebaseapp.com",
            projectId: "wikimind-rate",
            storageBucket: "wikimind-rate.firebasestorage.app",
            messagingSenderId: "906984793060",
            appId: "1:906984793060:web:1a86afa1a1dc584ea95df1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        
        // Auth anonyme pour permettre l'√©criture dans la DB
        signInAnonymously(auth).catch((error) => console.error("Auth Error:", error));

        // --- GLOBAL VARIABLES & FUNCTIONS EXPORT ---
        window.rateApp = function(appId, stars) {
            // 1. Check if already voted locally
            if (localStorage.getItem(`wikimind_voted_${appId}`)) {
                alert("Vous avez d√©j√† vot√© pour cette application !");
                return;
            }

            // 2. Transaction Firebase
            const appRef = ref(db, 'ratings/' + appId);
            runTransaction(appRef, (currentData) => {
                if (currentData === null) {
                    return { total: stars, count: 1 };
                } else {
                    return { total: currentData.total + stars, count: currentData.count + 1 };
                }
            }).then(() => {
                // 3. Mark as voted locally
                localStorage.setItem(`wikimind_voted_${appId}`, stars);
                // Refresh UI (optimistic)
                updateStarDisplay(appId, stars); 
            }).catch((err) => console.error("Vote failed", err));
        };

        // Donn√©es statiques des apps
        const appsData = {
            "wikimind": { title: "WikiMind AI", icon: "üß†", tag: "Flagship", tagColor: "bg-blue-100 text-blue-600", desc: "Assistant cognitif ultime.", features: ["Multi-Mod√®les", "Analyse Doc", "Chat Partag√©"], extras: ["PDF Gen", "Data Viz"], url: "Wikimind_AI.html" },
            "cours": { title: "WikiMind Cours", icon: "üìù", tag: "Workspace", tagColor: "bg-teal-100 text-teal-600", desc: "Prise de notes intelligente.", features: ["√âditeur Riche", "Dict√©e", "Restructuration"], extras: ["Cloud Save", "Export"], url: "Wikimind_cours.html" },
            "bac": { title: "WikiMind BAC", icon: "üéì", tag: "√âducation", tagColor: "bg-red-100 text-red-600", desc: "Simulateur Bac 2026.", features: ["Multi-Fili√®res", "Calcul Live"], extras: ["Coeffs √† jour"], url: "Wikimind_BAC.html" },
            "study": { title: "WikiMind Study", icon: "‚è±Ô∏è", tag: "Productivit√©", tagColor: "bg-green-100 text-green-600", desc: "Focus OS & Pomodoro.", features: ["Timer", "Planning IA"], extras: ["Ambiance"], url: "WikiMind_study.html" },
            "maths": { title: "WikiMind Maths", icon: "üìê", tag: "Sciences", tagColor: "bg-purple-100 text-purple-600", desc: "Solveur math√©matique.", features: ["Pas √† Pas", "G√©om√©trie"], extras: ["Historique"], url: "Wikimind_maths.html" },
            "cloud": { title: "WikiMind Cloud", icon: "‚òÅÔ∏è", tag: "Stockage", tagColor: "bg-gray-100 text-gray-600", desc: "Stockage s√©curis√©.", features: ["Auth", "Base64"], extras: ["Firebase"], url: "Wikimind_cloud.html" },
            "create": { title: "WikiMind Create", icon: "üé®", tag: "Cr√©ativit√©", tagColor: "bg-pink-100 text-pink-600", desc: "Studio visuel Pro.", features: ["Images HD", "Vid√©o"], extras: ["No-Code"], url: "Wikimind_creator.html" },
            "finance": { title: "WikiMind Finance", icon: "üí∏", tag: "Gestion", tagColor: "bg-yellow-100 text-yellow-600", desc: "Budget intelligent.", features: ["Suivi Live", "Conseiller IA"], extras: ["S√©curit√©"], url: "Wikimind_finance.html" },
            "diaporama": { title: "WikiMind Diaporama", icon: "üéûÔ∏è", tag: "B√™ta", tagColor: "bg-orange-100 text-orange-600", desc: "Pr√©sentations IA.", features: ["Gen Mistral", "JSON"], extras: ["Plein √âcran"], url: "Wikimind_diaporama.html" },
            "games": { title: "WikiMind Games", icon: "üéÆ", tag: "Arcade", tagColor: "bg-indigo-100 text-indigo-600", desc: "Hub ludique & √âchecs.", features: ["Chess IA", "ELO"], extras: ["Multi"], url: "Wikimind_games.html" },
            "detector": { title: "WikiMind Detector", icon: "üõ°Ô∏è", tag: "AI Analysis", tagColor: "bg-indigo-100 text-indigo-600", desc: "D√©tecteur d'IA.", features: ["Score %", "Moteur 6.2"], extras: ["GPT-4"], url: "https://chpalitom09-bot.github.io/Wikimind_All/Wikimind_detect.html" },
            "humanizer": { title: "WikiMind Humanizer", icon: "üß¨", tag: "Style", tagColor: "bg-violet-100 text-violet-600", desc: "R√©√©criture naturelle.", features: ["Ind√©tectable", "Fluide"], extras: ["Illimit√©"], url: "Wikimind_humanise.html" },
            "3d": { title: "WikiMind 3D", icon: "üßä", tag: "Design CAD", tagColor: "bg-cyan-100 text-cyan-600", desc: "CAO Hybride.", features: ["2D vers 3D", "Gen IA"], extras: ["STL"], url: "Wikimind_3D.html" },
            "tableur": { title: "WikiMind Tableur", icon: "üìä", tag: "Bient√¥t", tagColor: "bg-gray-200 text-gray-500", desc: "Tableur IA.", features: ["Formules IA"], extras: ["2026"], url: "#" }
        };

        // Store live ratings here
        const liveRatings = {};

        // --- LISTENERS ---
        function setupListeners() {
            Object.keys(appsData).forEach(key => {
                if(appsData[key].url === "#") return; // Skip comming soon

                const appRef = ref(db, 'ratings/' + key);
                onValue(appRef, (snapshot) => {
                    const val = snapshot.val();
                    if (val) {
                        const avg = (val.total / val.count).toFixed(1);
                        liveRatings[key] = { average: avg, count: val.count };
                    } else {
                        // Default if no votes yet
                        liveRatings[key] = { average: "0.0", count: 0 };
                    }
                    updateStarDisplay(key);
                });
            });
        }
        setupListeners();

        function updateStarDisplay(appId) {
            const data = liveRatings[appId] || { average: "...", count: 0 };
            const myVote = localStorage.getItem(`wikimind_voted_${appId}`);
            
            // Update Card widgets if they exist
            const widgetId = `stars-${appId}`;
            const widgetEl = document.getElementById(widgetId);
            if (widgetEl) {
                widgetEl.innerHTML = generateStarHTML(appId, data.average, 'sm', myVote);
            }

            // Update Detail View if active
            if (document.getElementById('view-detail').style.display === 'block') {
                const title = document.getElementById('detail-title').innerText;
                // Find key by title (ugly but works given structure)
                const currentKey = Object.keys(appsData).find(k => appsData[k].title === title);
                if (currentKey === appId) {
                    document.getElementById('detail-stars').innerHTML = generateStarHTML(appId, data.average, 'lg', myVote);
                    const voteText = myVote ? `(Votre vote: ${myVote})` : '';
                    document.getElementById('detail-rating-text').innerText = `${data.average}/5 ‚Ä¢ ${data.count} avis ${voteText}`;
                }
            }
        }

        function generateStarHTML(appId, average, size, myVote) {
            let html = `<div class="flex items-center gap-1 ${size === 'lg' ? 'text-2xl' : 'text-sm'} text-gray-300">`;
            const score = parseFloat(average);
            for (let i = 1; i <= 5; i++) {
                // Gold if i <= average OR if user just clicked it (visual feedback handled by reload usually)
                // Here we show average in Gold.
                let colorClass = (i <= Math.round(score)) ? 'text-yellow-400' : 'text-gray-300 dark:text-gray-700';
                
                // If user voted this specific star, maybe distinct? keep simple for now
                html += `<span onclick="event.stopPropagation(); window.rateApp('${appId}', ${i})" class="cursor-pointer hover:text-yellow-500 transition-colors ${colorClass}">‚òÖ</span>`;
            }
            html += `</div>`;
            if (size === 'sm') html += `<span class="ml-2 text-xs text-gray-400 font-bold">(${average})</span>`;
            return html;
        }

        // --- EXPOSE TO GLOBAL SCOPE FOR HTML ---
        window.appsData = appsData; // Needed for rendering
        window.generateStarHTML = generateStarHTML;
        window.liveRatings = liveRatings;
    </script>

    <script>
        // --- ANIMATION CANVAS ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function initCanvas() {
            resize(); createParticles(); animate();
        }
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        function createParticles() {
            particles = [];
            const count = window.innerWidth < 768 ? 30 : 60;
            for (let i = 0; i < count; i++) {
                particles.push({ x: Math.random() * width, y: Math.random() * height, vx: (Math.random() - 0.5) * 0.5, vy: (Math.random() - 0.5) * 0.5, size: Math.random() * 2 + 1 });
            }
        }
        function animate() {
            ctx.clearRect(0, 0, width, height);
            const isDark = document.body.classList.contains('dark-mode');
            ctx.fillStyle = isDark ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)';
            ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';
            
            for (let i = 0; i < particles.length; i++) {
                let p = particles[i]; p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > width) p.vx *= -1; if (p.y < 0 || p.y > height) p.vy *= -1;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
                for (let j = i + 1; j < particles.length; j++) {
                    let p2 = particles[j]; let dist = Math.hypot(p.x - p2.x, p.y - p2.y);
                    if (dist < 150) { ctx.lineWidth = 1 - dist / 150; ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke(); }
                }
            }
            requestAnimationFrame(animate);
        }
        window.addEventListener('resize', () => { resize(); createParticles(); });

        // --- INTRO LOADER LOGIC ---
        window.addEventListener('load', () => {
            initCanvas();
            setTimeout(() => {
                const overlay = document.getElementById('intro-overlay');
                const wrapper = document.getElementById('app-wrapper');
                
                overlay.style.opacity = '0';
                overlay.style.visibility = 'hidden';
                
                wrapper.classList.remove('opacity-0');
                wrapper.classList.add('content-reveal');
                document.body.style.overflow = 'auto'; // Re-enable scroll
            }, 2200); // 2.2s splash duration
        });

        // --- APP LOGIC ---
        function switchView(viewName) {
            document.querySelectorAll('.view-container').forEach(el => {
                el.classList.remove('active');
                setTimeout(() => { if(!el.classList.contains('active')) el.style.display = 'none'; }, 400);
            });
            const target = document.getElementById(`view-${viewName}`);
            target.style.display = 'block';
            setTimeout(() => target.classList.add('active'), 10);
            window.scrollTo({ top: 0, behavior: 'smooth' });

            if(viewName === 'catalog') renderCatalog();
            if(viewName === 'home') renderHomeGrid();
        }

        function renderCatalog() {
            const grid = document.getElementById('catalog-grid');
            grid.innerHTML = '';
            Object.keys(window.appsData).forEach(key => {
                grid.innerHTML += createAppCard(key, window.appsData[key]);
            });
        }

        function renderHomeGrid() {
            const grid = document.getElementById('home-grid');
            grid.innerHTML = '';
            ['wikimind', 'cours', 'bac', 'study', 'maths', 'create'].forEach(key => {
                if(window.appsData[key]) grid.innerHTML += createAppCard(key, window.appsData[key]);
            });
        }

        function createAppCard(key, app) {
            const isComingSoon = app.url === "#";
            const extraClasses = isComingSoon ? "opacity-75 grayscale hover:grayscale-0" : "";
            // Use global window functions for HTML string generation
            const ratingData = window.liveRatings && window.liveRatings[key] ? window.liveRatings[key] : { average: "...", count: 0 };
            const myVote = localStorage.getItem(`wikimind_voted_${key}`);
            const ratingHTML = isComingSoon ? '' : `<div id="stars-${key}" class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-800 flex justify-between items-center">${window.generateStarHTML ? window.generateStarHTML(key, ratingData.average, 'sm', myVote) : 'Loading...'}</div>`;

            return `
                <div onclick="openAppDetail('${key}')" class="app-card p-8 group flex flex-col justify-between min-h-[340px] flex-[1_1_300px] max-w-[400px] ${extraClasses}">
                    <div>
                        <div class="flex justify-between items-start">
                            <div class="icon-box group-hover:bg-black group-hover:text-white dark:group-hover:bg-white dark:group-hover:text-black transition-colors duration-300">${app.icon}</div>
                            <span class="${app.tagColor} text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wider">${app.tag}</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-2 ${isComingSoon ? 'text-gray-400' : ''}">${app.title}</h3>
                        <p class="text-sm ${isComingSoon ? 'text-gray-400' : 'text-gray-500'} font-medium leading-relaxed line-clamp-3">${app.desc}</p>
                    </div>
                    <div>
                        ${ratingHTML}
                        <div class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest mt-6 ${isComingSoon ? 'text-gray-300' : ''} group-hover:gap-4 transition-all duration-300">
                            ${isComingSoon ? 'En d√©veloppement...' : 'D√©couvrir <span class="text-lg">‚Üí</span>'}
                        </div>
                    </div>
                </div>`;
        }

        function openAppDetail(appId) {
            const app = window.appsData[appId];
            if (!app) return;
            document.getElementById('detail-title').innerText = app.title;
            document.getElementById('detail-icon').innerText = app.icon;
            document.getElementById('detail-desc').innerText = app.desc;
            
            const tagEl = document.getElementById('detail-tag');
            tagEl.className = `inline-block mb-2 px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider ${app.tagColor}`;
            tagEl.innerText = app.tag;

            // Rating
            if(window.liveRatings && window.liveRatings[appId]) {
                 const data = window.liveRatings[appId];
                 const myVote = localStorage.getItem(`wikimind_voted_${appId}`);
                 document.getElementById('detail-stars').innerHTML = window.generateStarHTML(appId, data.average, 'lg', myVote);
                 document.getElementById('detail-rating-text').innerText = `${data.average}/5 ‚Ä¢ ${data.count} avis`;
            }

            if (app.url === "#") {
                const btn = document.getElementById('detail-btn');
                btn.href = "#"; btn.classList.add('opacity-50', 'cursor-not-allowed'); btn.innerText = "Indisponible";
            } else {
                const btn = document.getElementById('detail-btn');
                btn.href = app.url; btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.innerHTML = `Ouvrir l'application <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>`;
            }

            document.getElementById('detail-features').innerHTML = app.features.map(f => `<li class="flex items-start gap-3"><span class="mt-1 text-green-500">‚úì</span><span>${f}</span></li>`).join('');
            document.getElementById('detail-extras').innerHTML = app.extras.map(e => `<div class="flex items-center gap-3 p-3 bg-white dark:bg-black rounded-lg border border-gray-100 dark:border-gray-800"><div class="w-2 h-2 rounded-full bg-gray-400"></div><span class="text-sm font-medium">${e}</span></div>`).join('');
            switchView('detail');
        }

        // Theme
        function toggleTheme() {
            const body = document.body; body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            localStorage.setItem('wikimind_landing_theme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
        }
        function updateThemeIcon(isDark) {
            const path = document.querySelector('#theme-icon path');
            if(isDark) path.setAttribute('d', 'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z');
            else path.setAttribute('d', 'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z');
        }
        if (localStorage.getItem('wikimind_landing_theme') === 'dark' || (!localStorage.getItem('wikimind_landing_theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark-mode'); updateThemeIcon(true);
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>
